{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% load static %}
{% block title %}
    {% trans "Revision for" %} {{ revision.name }}
{% endblock %}
{% block content %}
    <div class="container">
        {# --- Header and Warning Banner --- #}
        <div class="alert alert-warning text-center" role="alert">
            <i class="fa fa-exclamation-triangle"></i>
            {% blocktrans with date=revision.created|naturaltime user=revision.set_by.username %}
                You are viewing a historical revision of this secret created on <strong>{{ date }}</strong> by <strong>{{ user }}</strong>. This is not the current version.
            {% endblocktrans %}
            <a href="{{ secret.get_absolute_url }}" class="alert-link ms-2">{% trans "View Current Version" %}</a>
        </div>
        <div class="row mb-3 justify-content-between px-0 text-break">
            <div class="col-10 h2 flex-grow-1">
                <a href="{{ secret.get_absolute_url }}">Revision of {{ secret.name }}</a>
            </div>
            <div class="col-auto h2 d-flex gap-2 justify-content-end align-items-end">
                <span data-bs-toggle="tooltip"
                      title="{{ revision.created|date:'DATETIME_FORMAT' }}">
                    <i class="fa fa-clock text-secondary"></i>
                </span>
            </div>
        </div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'secrets.secret-list' %}">{% trans "Secrets" %}</a>
                </li>
                <li class="breadcrumb-item">
                    <a href="{{ secret.get_absolute_url }}">{{ secret.name }}</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">{% trans "Revision" %}</li>
            </ol>
        </nav>
        {# — Main card — #}
        <div class="card shadow">
            <div class="card-body">
                <dl class="row mb-0">
                    <dt class="col-sm-3">{% trans "Username" %}</dt>
                    <dd class="col-sm-9">
                        {{ revision.username|default:"–" }}
                    </dd>
                    <dt class="col-sm-3">{% trans "URL" %}</dt>
                    <dd class="col-sm-9 text-break">
                        {{ revision.url|default:"–" }}
                    </dd>
                    {% if secret.content_type == ContentType.FILE %}
                        <dt class="col-sm-3">{% trans "File" %}</dt>
                        <dd class="col-sm-9">
                            <a href="{% url 'secrets.revision-download' revision_hashid=revision.hashid %}"
                               class="btn btn-sm btn-outline-secondary">
                                <i class="fa fa-download"></i> {{ revision.filename|default:_("Download") }}
                            </a>
                        </dd>
                    {% elif secret.content_type == ContentType.PASSWORD %}
                        <dt class="col-sm-3">{% trans "Password" %}</dt>
                        <dd class="col-sm-9">
                            <code id="password-hidden">••••••••••••</code>
                            <code id="password-revealed" class="d-none">{{ decrypted_data.password }}</code>
                            <button id="reveal-btn" class="btn btn-sm btn-outline-secondary ms-2">
                                <i class="fa fa-eye"></i>
                            </button>
                        </dd>
                    {% elif secret.content_type == ContentType.CC %}
                        <dt class="col-sm-3">{% trans "Credit Card" %}</dt>
                        <dd class="col-sm-9">
                            {# TODO add some credit card rendering here, too #}
                        </dd>
                    {% endif %}
                    <dt class="col-sm-3">{% trans "Description" %}</dt>
                    <dd class="col-sm-9">
                        <pre>{{ revision.description|default:"–" }}</pre>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
    <script>
document.addEventListener('DOMContentLoaded', () => {
  const btn      = document.getElementById('reveal-btn');
  if (!btn) return;                       // safety guard

  const hidden   = document.getElementById('password-hidden');
  const revealed = document.getElementById('password-revealed');

  btn.addEventListener('click', event => {
    event.preventDefault();               // stop anchor / form defaults
    hidden.classList.toggle('d-none');
    revealed.classList.toggle('d-none');

    const icon = btn.querySelector('i');
    icon.classList.toggle('fa-eye');
    icon.classList.toggle('fa-eye-slash');
  });
});
    </script>
{% endblock %}

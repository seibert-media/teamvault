{% extends "base.html" %}
{% load i18n %}
{% load humanize %}

{% block title %}{% trans "Revision for" %} {{ revision.name }}{% endblock %}

{% block content %}
<div class="container">

    {# --- Header and Warning Banner --- #}
    <div class="alert alert-warning text-center" role="alert">
        <i class="fa fa-exclamation-triangle"></i>
        {% blocktrans with date=revision.created|naturaltime user=revision.set_by.username %}
        You are viewing a historical revision of this secret created on <strong>{{ date }}</strong> by <strong>{{ user }}</strong>. This is not the current version.
        {% endblocktrans %}
        <a href="{{ secret.get_absolute_url }}" class="alert-link ms-2">{% trans "View Current Version" %}</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-header bg-light">
            <h2 class="my-2">
                <a href="{{ secret.get_absolute_url }}">{{ secret.name }}</a> &raquo; {% trans "Revision" %}
            </h2>
        </div>
        <div class="card-body">
            <dl class="row">
                <dt class="col-sm-3">{% trans "Name" %}</dt>
                <dd class="col-sm-9">{{ revision.name }}</dd>

                <dt class="col-sm-3">{% trans "Username" %}</dt>
                <dd class="col-sm-9">{{ revision.username|default:"-" }}</dd>

                <dt class="col-sm-3">{% trans "URL" %}</dt>
                <dd class="col-sm-9">{{ revision.url|default:"-" }}</dd>

                <dt class="col-sm-3">{% trans "Password" %}</dt>
                <dd class="col-sm-9">
                    <div id="password-wrapper" class="d-flex align-items-center">
                        <span id="password-hidden" class="text-muted">••••••••••••</span>
                        <span id="password-revealed" class="font-monospace" style="display:none;">{{ decrypted_data.password }}</span>
                        <button id="reveal-button" class="btn btn-sm btn-outline-secondary ms-3">
                            <i class="fa fa-eye"></i> {% trans "Reveal" %}
                        </button>
                    </div>
                </dd>

                <dt class="col-sm-3">{% trans "Description" %}</dt>
                <dd class="col-sm-9"><pre>{{ revision.description|default:"-" }}</pre></dd>
            </dl>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const revealButton = document.getElementById('reveal-button');
    const passwordHidden = document.getElementById('password-hidden');
    const passwordRevealed = document.getElementById('password-revealed');
    let isRevealed = false;

    revealButton.addEventListener('click', function() {
        if (isRevealed) {
            passwordHidden.style.display = 'inline';
            passwordRevealed.style.display = 'none';
            revealButton.innerHTML = '<i class="fa fa-eye"></i> {% trans "Reveal" %}';
        } else {
            passwordHidden.style.display = 'none';
            passwordRevealed.style.display = 'inline';
            revealButton.innerHTML = '<i class="fa fa-eye-slash"></i> {% trans "Hide" %}';
        }
        isRevealed = !isRevealed;
    });
});
</script>
{% endblock %}

{% extends "base.html" %}
{% load i18n %}
{% load humanize %}
{% block title %}
    {% trans "Revisions for" %} {{ secret.name }}
{% endblock %}
{% block content %}
    <div class="container">
        <h2 class="mb-3">
            {% trans "Revisions for" %} <a href="{{ secret.get_absolute_url }}">{{ secret.name }}</a>
        </h2>
        <div class="card">
            <div class="card-body table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>{% trans "Date" %}</th>
                            <th>{% trans "Changed by" %}</th>
                            <th>{% trans "Name" %}</th>
                            <th>{% trans "Details" %}</th>
                            <th>{% trans "View" %}</th>
                        </tr>
                    </thead>
                    <tbody>
                      {% for r in rows %}
                        <tr>
                          <td>{{ r.ts|naturaltime }}</td>
                          <td>
                            {% if r.kind == "payload" %}
                              <i class="fa fa-key text-primary ms-1" data-bs-toggle="tooltip"
                                 title="{% trans 'Secret value changed' %}"></i>
                            {% else %}
                              <i class="fa fa-pencil text-muted ms-1" data-bs-toggle="tooltip"
                                 title="{% trans 'Metadata changed' %}"></i>
                            {% endif %}
                            {{ r.user }}
                          </td>

                          <td>{{ r.name }}</td>

                          <td>
                            {% if r.kind == "payload" %}
                  <strong>Username:</strong> <code>{{ r.uname|default:"∅" }}</code>
                            {% else %}
                              {% if r.changes %}
                                {% for c in r.changes %}
                                  <strong>{{ c.label }}:</strong>
                                  <code>{{ c.old|default:"∅" }} → {{ c.new|default:"∅" }}</code><br>
                                {% endfor %}
                              {% else %}
                                —
                              {% endif %}
                            {% endif %}
                          </td>

                          <td>
                              <a href="{{ r.link }}"
                                 class="btn btn-sm btn-light"><i class="fa fa-eye"></i></a>
                              {% if r.current %}
                                <span data-bs-toggle="tooltip"
                                      title="{% trans 'Current version' %}">
                                  <i class="fa fa-star text-warning"></i>
                                </span>
                              {% endif %}
                          </td>
                        </tr>
                      {% endfor %}
                    </tbody>
              </table>
            </div>
        </div>
    </div>
{% endblock %}
